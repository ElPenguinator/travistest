language: node_js
sudo: required
services:
- docker
dist: trusty
addons:
  apt:
    sources:
      - google-chrome
    packages:
      - google-chrome-stable
cache:
  directories:
  - node_modules
node_js:
- 6
before_install:
- cd api/
- npm install -g node-gyp
- "/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1280x1024x16"
before_script:
- "export DISPLAY=:99.0"
- "sh -e /etc/init.d/xvfb start"
- sleep 3 # give xvfb some time to start
- npm install -g standard
- docker-compose build
- docker-compose up -d
- sleep 3
- mongo "localhost:27017/nodetest1" --eval "db.dropDatabase();"
script:
- cd ../api
- npm test
- cd ../web-app
- npm install
- npm run e2e
after_success: 
after_script:
- docker-compose kill
before_deploy:
- cd ..
deploy:
  provider: heroku
  api_key:
    secure: f8Rhp6PLl/iMAmQOOZo9QhYYpSO7Ur9QDIJajnjXbSq2hfuqHc0XMJ9YkyWtkeNzTDllXQyd588frt9wZhJLhZbK/jbxJzyjAsfo91cSp+9Oxjy7oVjla0TUSrfo5/K+UG9QhF5fE86DuOC4qmB+CztOB5Vwz4RFHyuSHwEAbHfHX1K3oNPgJ8BiXWLj2lDn3aZB1Wiq9eAtwWYMbaxH/Zace3YQjFCuBU0mNT/qFq1damNB3zXaB+iPW3T9aOg52lAcNzf40WkoyTQxEAZ715/RPLQleNY2WOc18n/8L3go/eEC/6quRfcXZELZCIQCUak9uPGlPayqhFH+QB9W8n8NPuyWapENCXQMrUYbtp3uLjitQ/s2uoAqIXew//lFBns4Zk+xBr89fJMFT/IVvaci8GaybKeAMB019n2VJiF9mzgnUpJn4djZDcJL0I7c8PZj7Pzqt/cbQ5csUtzjV4lRJRtUWr3SXidOvTwEgAQrCBbtT6mdKmp0NIsv/KSB4VLiPey/yLLd6QRAEIoRaSE/WxezkRK++ai4Da/SlUwEMyfXfEg4TXFnevasOwW9NAGXQGDpiANS0O26oHV23xGZx8O6vhJOgaMgyTtM/497kRbeqKAxXOsi2+L52DmsJX+gi3CJ/ISbuizUwejfzADBy5t2Tk3dDB2ERqRza9Y=
  app: damp-thicket-46818
  on:
  repo: ElPenguinator/travistest